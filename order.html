<div class="summary-row">
                                <span>Pack sélectionné :</span>
                                <span id="selectedPackageName">-</span>
                            </div>
                            <div class="summary-row">
                                <span>Prix du pack :</span>
                                <span id="packagePrice">-</span>
                            </div>
                            <div class="summary-row" id="engravingPriceRow" style="display: none;">
                                <span>Gravure personnalisée :</span>
                                <span id="engravingPrice">-</span>
                            </div>
                            <div class="summary-row">
                                <span>Frais de livraison :</span>
                                <span>4,99 €</span>
                            </div>
                            <div class="summary-row total">
                                <span>Total :</span>
                                <span id="totalPrice">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="step-navigation">
                        <button class="nav-button prev-button" id="step2Prev">Précédent</button>
                        <button class="nav-button next-button" id="step2Next">Continuer</button>
                    </div>
                </div>

                <!-- Step 3: Shipping Information -->
                <div class="step-content" id="step3">
                    <div class="shipping-form">
                        <h3 class="form-title">Informations de livraison</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName" class="form-label">Prénom *</label>
                                <input type="text" id="firstName" name="firstName" class="form-input" required>
                                <div class="error-message" id="firstNameError">Veuillez entrer votre prénom</div>
                            </div>
                            <div class="form-group">
                                <label for="lastName" class="form-label">Nom *</label>
                                <input type="text" id="lastName" name="lastName" class="form-input" required>
                                <div class="error-message" id="lastNameError">Veuillez entrer votre nom</div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="email" class="form-label">Email *</label>
                            <input type="email" id="email" name="email" class="form-input" required>
                            <div class="error-message" id="emailError">Veuillez entrer une adresse email valide</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone" class="form-label">Téléphone *</label>
                            <input type="tel" id="phone" name="phone" class="form-input" required>
                            <div class="error-message" id="phoneError">Veuillez entrer un numéro de téléphone valide</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="address" class="form-label">Adresse *</label>
                            <input type="text" id="address" name="address" class="form-input" required>
                            <div class="error-message" id="addressError">Veuillez entrer votre adresse</div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="postalCode" class="form-label">Code postal *</label>
                                <input type="text" id="postalCode" name="postalCode" class="form-input" required>
                                <div class="error-message" id="postalCodeError">Veuillez entrer un code postal valide</div>
                            </div>
                            <div class="form-group">
                                <label for="city" class="form-label">Ville *</label>
                                <input type="text" id="city" name="city" class="form-input" required>
                                <div class="error-message" id="cityError">Veuillez entrer votre ville</div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="country" class="form-label">Pays *</label>
                            <select id="country" name="country" class="form-input" required>
                                <option value="">Sélectionnez un pays</option>
                                <option value="FR">France</option>
                                <option value="BE">Belgique</option>
                                <option value="CH">Suisse</option>
                                <option value="LU">Luxembourg</option>
                                <option value="CA">Canada</option>
                                <option value="MC">Monaco</option>
                            </select>
                            <div class="error-message" id="countryError">Veuillez sélectionner un pays</div>
                        </div>
                    </div>

                    <div class="step-navigation">
                        <button class="nav-button prev-button" id="step3Prev">Précédent</button>
                        <button class="nav-button next-button" id="step3Next">Continuer</button>
                    </div>
                </div>

                <!-- Step 4: Payment -->
                <div class="step-content" id="step4">
                    <div class="order-summary">
                        <h3 class="summary-title">Récapitulatif de votre commande</h3>
                        
                        <div class="summary-section">
                            <h4 class="summary-section-title">Produit</h4>
                            <div class="summary-item">
                                <span class="summary-item-label">Pack sélectionné :</span>
                                <span id="summaryPackageName">-</span>
                            </div>
                            <div class="summary-item" id="summaryEngravingRow" style="display: none;">
                                <span class="summary-item-label">Gravure personnalisée :</span>
                                <span id="summaryEngraving">-</span>
                            </div>
                        </div>
                        
                        <div class="summary-section">
                            <h4 class="summary-section-title">Livraison</h4>
                            <div class="summary-item">
                                <span class="summary-item-label">Adresse :</span>
                                <span id="summaryAddress">-</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-item-label">Méthode :</span>
                                <span>Livraison standard (3-5 jours ouvrés)</span>
                            </div>
                        </div>
                        
                        <div class="summary-section">
                            <h4 class="summary-section-title">Paiement</h4>
                            <div class="summary-item">
                                <span class="summary-item-label">Prix du pack :</span>
                                <span id="summaryPackagePrice">-</span>
                            </div>
                            <div class="summary-item" id="summaryEngravingPriceRow" style="display: none;">
                                <span class="summary-item-label">Gravure personnalisée :</span>
                                <span id="summaryEngravingPrice">-</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-item-label">Frais de livraison :</span>
                                <span>4,99 €</span>
                            </div>
                        </div>
                        
                        <div class="summary-total">
                            <span>Total :</span>
                            <span id="summaryTotalPrice">-</span>
                        </div>
                    </div>

                    <div class="payment-section">
                        <h3 class="payment-title">Choisir un moyen de paiement</h3>
                        
                        <div class="payment-options">
                            <div class="payment-option" data-method="apple-pay">
                                <div class="payment-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12 19c-2.3 0-6.4-.2-8.1-1.7-1.4-1.2-1-3.1-1-3.8.1-1.4.5-3.4 3.1-3.7.8-.1 1.6.5 2.7 1.1 1.3.7 2.8 1.1 3.3 1.1.5 0 2-.4 3.3-1.1 1.1-.6 1.9-1.2 2.7-1.1 2.6.3 3 2.3 3.1 3.7 0 .7.4 2.6-1 3.8-1.7 1.5-5.8 1.7-8.1 1.7z"/>
                                        <path d="M12 4c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2z"/>
                                    </svg>
                                </div>
                                <div class="payment-details">
                                    <div class="payment-name">Apple Pay</div>
                                    <div class="payment-description">Paiement rapide et sécurisé</div>
                                </div>
                            </div>
                            <div class="payment-option" data-method="crypto">
                                <div class="payment-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M15 9.354a4 4 0 1 0 0 5.292"></path>
                                    </svg>
                                </div>
                                <div class="payment-details">
                                    <div class="payment-name">Crypto via Coinbase</div>
                                    <div class="payment-description">Bitcoin, Ethereum et autres cryptomonnaies</div>
                                </div>
                            </div>
                            <div class="payment-option" data-method="paypal">
                                <div class="payment-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M7.144 19.532l1.049-5.751c.11-.606.691-1.002 1.304-.948 2.155.19 6.043.223 8.213-3.729.498-.9.809-1.816.935-2.704.138-.998-.209-1.696-.729-2.095C16.285 3.118 13.395 3 12 3H5.999c-.64 0-1.18.32-1.365.829L1 19l6.144.532z"></path>
                                        <path d="M16.092 7.845c.571-.52.871-1.32.731-2.321-.129-.884-.372-1.604-.732-2.175"></path>
                                    </svg>
                                </div>
                                <div class="payment-details">
                                    <div class="payment-name">PayPal</div>
                                    <div class="payment-description">Paiement sécurisé via votre compte PayPal</div>
                                </div>
                            </div>
                            <div class="payment-option" data-method="card">
                                <div class="payment-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                        <line x1="1" y1="10" x2="23" y2="10"></line>
                                    </svg>
                                </div>
                                <div class="payment-details">
                                    <div class="payment-name">Carte bancaire</div>
                                    <div class="payment-description">Visa, Mastercard, American Express</div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment method containers -->
                        <div class="payment-method-container" id="cardForm">
                            <div class="form-group">
                                <label for="cardNumber" class="form-label">Numéro de carte</label>
                                <input type="text" id="cardNumber" class="form-input" placeholder="1234 5678 9012 3456">
                            </div>
                            <div class="form-group">
                                <label for="cardName" class="form-label">Nom sur la carte</label>
                                <input type="text" id="cardName" class="form-input" placeholder="Jean Dupont">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cardExpiry" class="form-label">Date d'expiration</label>
                                    <input type="text" id="cardExpiry" class="form-input" placeholder="MM/AA">
                                </div>
                                <div class="form-group">
                                    <label for="cardCvc" class="form-label">CVC</label>
                                    <input type="text" id="cardCvc" class="form-input" placeholder="123">
                                </div>
                            </div>
                        </div>

                        <div class="payment-method-container" id="paypalContainer">
                            <div id="paypal-button-container"></div>
                        </div>

                        <div class="payment-method-container" id="cryptoContainer">
                            <p style="margin-bottom: 20px; color: #ccc;">Vous serez redirigé vers Coinbase Commerce pour finaliser votre paiement en cryptomonnaie.</p>
                        </div>

                        <div class="payment-method-container" id="applePayContainer">
                            <p style="margin-bottom: 20px; color: #ccc;">Vous pourrez finaliser votre paiement avec Apple Pay sur l'écran suivant.</p>
                        </div>
                    </div>

                    <div class="step-navigation">
                        <button class="nav-button prev-button" id="step4Prev">Précédent</button>
                        <button class="nav-button next-button" id="step4Next" disabled>Finaliser la commande</button>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <div class="footer-content">
                <div class="copyright">© 2024 SEED. Tous droits réservés.</div>
                <div class="footer-links">
                    <a href="index.html" class="footer-link">Accueil</a>
                    <a href="confidentialite.html" class="footer-link">Confidentialité</a>
                    <a href="conditions.html" class="footer-link">Conditions</a>
                    <a href="contact.html" class="footer-link">Contact</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Processing Overlay -->
    <div class="processing-overlay" id="processingOverlay">
        <div class="spinner"></div>
        <div class="processing-text">Traitement du paiement en cours...</div>
    </div>

    <script>
        // Variables globales pour stocker les informations de commande
        let orderData = {
            package: null,
            packageName: '',
            packagePrice: 0,
            platesCount: 0,
            engraving: {
                enabled: false,
                platesCount: 0,
                type: 'same', // 'same' or 'different'
                texts: []
            },
            shipping: {},
            paymentMethod: null,
            totalPrice: 0
        };

        // Prix constants
        const SHIPPING_PRICE = 4.99;
        const ENGRAVING_PRICE_PER_PLATE = 9.99;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initPackageSelection();
            initCustomization();
            initShippingForm();
            initPaymentOptions();
            initNavigation();
            initPayPal();
        });

        // Initialiser la sélection de package
        function initPackageSelection() {
            const packages = document.querySelectorAll('.package');
            const nextButton = document.getElementById('step1Next');

            packages.forEach(pkg => {
                pkg.addEventListener('click', () => {
                    // Désélectionner tous les packages
                    packages.forEach(p => p.classList.remove('selected'));
                    
                    // Sélectionner le package cliqué
                    pkg.classList.add('selected');
                    
                    // Activer le bouton suivant
                    nextButton.disabled = false;
                    
                    // Stocker les informations du package
                    orderData.package = pkg.getAttribute('data-package');
                    orderData.packageName = pkg.querySelector('.package-name').textContent;
                    orderData.packagePrice = parseFloat(pkg.getAttribute('data-price'));
                    orderData.platesCount = parseInt(pkg.getAttribute('data-plates'));
                    
                    // Mettre à jour le prix total
                    updateTotalPrice();
                });
            });
        }

        // Initialiser les options de personnalisation
        function initCustomization() {
            const engravingToggle = document.getElementById('engravingToggle');
            const engravingOptions = document.getElementById('engravingOptions');
            const engravingTypeOptions = document.querySelectorAll('.engraving-type-option');
            const engravingInputs = document.querySelectorAll('.engraving-input');
            
            // Toggle de gravure personnalisée
            engravingToggle.addEventListener('change', () => {
                orderData.engraving.enabled = engravingToggle.checked;
                engravingOptions.style.display = engravingToggle.checked ? 'block' : 'none';
                
                // Mettre à jour le nombre de plaques à graver par défaut
                if (engravingToggle.checked) {
                    orderData.engraving.platesCount = 1;
                    updatePlatesCountSelector();
                } else {
                    orderData.engraving.platesCount = 0;
                }
                
                // Mettre à jour le prix total
                updateTotalPrice();
                
                // Mettre à jour l'affichage du prix de gravure
                document.getElementById('engravingPriceRow').style.display = engravingToggle.checked ? 'flex' : 'none';
            });
            
            // Options de type de gravure
            engravingTypeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    engravingTypeOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    
                    const type = option.getAttribute('data-type');
                    orderData.engraving.type = type;
                    
                    // Afficher/masquer les champs de saisie en fonction du type
                    updateEngravingInputs();
                });
            });
            
            // Champs de saisie de gravure
            engravingInputs.forEach(input => {
                input.addEventListener('input', () => {
                    const plateIndex = parseInt(input.closest('.engraving-input-group').getAttribute('data-plate')) - 1;
                    const text = input.value;
                    
                    // Mettre à jour le texte dans les données de commande
                    orderData.engraving.texts[plateIndex] = text;
                    
                    // Mettre à jour le compteur de caractères
                    const charCount = input.closest('.engraving-input-group').querySelector('.char-count');
                    charCount.textContent = text.length;
                    
                    // Mettre à jour l'aperçu
                    updateEngravingPreview(text);
                });
            });
        }

        // Mettre à jour le sélecteur de nombre de plaques
        function updatePlatesCountSelector() {
            const platesCountSelector = document.getElementById('platesCountSelector');
            const platesCountSection = document.getElementById('platesCountSection');
            
            // Afficher la section uniquement si le package contient plus d'une plaque
            platesCountSection.style.display = orderData.platesCount > 1 ? 'block' : 'none';
            
            if (orderData.platesCount <= 1) {
                orderData.engraving.platesCount = 1;
                return;
            }
            
            // Vider le sélecteur
            platesCountSelector.innerHTML = '';
            
            // Créer les options
            for (let i = 1; i <= orderData.platesCount; i++) {
                const option = document.createElement('div');
                option.className = 'plate-option';
                option.textContent = i;
                option.setAttribute('data-count', i);
                
                if (i === 1) {
                    option.classList.add('selected');
                }
                
                option.addEventListener('click', () => {
                    document.querySelectorAll('.plate-option').forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    
                    orderData.engraving.platesCount = i;
                    updateTotalPrice();
                    updateEngravingInputs();
                });
                
                platesCountSelector.appendChild(option);
            }
        }

        // Mettre à jour les champs de saisie de gravure
        function updateEngravingInputs() {
            const engravingInputGroups = document.querySelectorAll('.engraving-input-group');
            
            engravingInputGroups.forEach(group => {
                const plateIndex = parseInt(group.getAttribute('data-plate'));
                
                // Masquer tous les groupes par défaut
                group.classList.remove('active');
                
                // Afficher le premier groupe si type = 'same'
                if (orderData.engraving.type === 'same' && plateIndex === 1) {
                    group.classList.add('active');
                }
                
                // Afficher les groupes en fonction du nombre de plaques si type = 'different'
                if (orderData.engraving.type === 'different' && plateIndex <= orderData.engraving.platesCount) {
                    group.classList.add('active');
                }
            });
        }

        // Mettre à jour l'aperçu de gravure
        function updateEngravingPreview(text) {
            const previewText = document.getElementById('previewText');
            previewText.textContent = text || 'SEED.';
        }

        // Initialiser le formulaire de livraison
        function initShippingForm() {
            const shippingForm = document.querySelectorAll('#step3 .form-input');
            
            shippingForm.forEach(input => {
                input.addEventListener('input', () => {
                    // Stocker les informations de livraison
                    orderData.shipping[input.id] = input.value;
                });
            });
        }

        // Valider le formulaire de livraison
        function validateShippingForm() {
            let isValid = true;
            
            // Valider le prénom
            const firstName = document.getElementById('firstName');
            if (!firstName.value.trim()) {
                showError(firstName, 'firstNameError');
                isValid = false;
            } else {
                hideError(firstName, 'firstNameError');
            }
            
            // Valider le nom
            const lastName = document.getElementById('lastName');
            if (!lastName.value.trim()) {
                showError(lastName, 'lastNameError');
                isValid = false;
            } else {
                hideError(lastName, 'lastNameError');
            }
            
            // Valider l'email
            const email = document.getElementById('email');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email.value.trim() || !emailRegex.test(email.value)) {
                showError(email, 'emailError');
                isValid = false;
            } else {
                hideError(email, 'emailError');
            }
            
            // Valider le téléphone
            const phone = document.getElementById('phone');
            if (!phone.value.trim()) {
                showError(phone, 'phoneError');
                isValid = false;
            } else {
                hideError(phone, 'phoneError');
            }
            
            // Valider l'adresse
            const address = document.getElementById('address');
            if (!address.value.trim()) {
                showError(address, 'addressError');
                isValid = false;
            } else {
                hideError(address, 'addressError');
            }
            
            // Valider le code postal
            const postalCode = document.getElementById('postalCode');
            if (!postalCode.value.trim()) {
                showError(postalCode, 'postalCodeError');
                isValid = false;
            } else {
                hideError(postalCode, 'postalCodeError');
            }
            
            // Valider la ville
            const city = document.getElementById('city');
            if (!city.value.trim()) {
                showError(city, 'cityError');
                isValid = false;
            } else {
                hideError(city, 'cityError');
            }
            
            // Valider le pays
            const country = document.getElementById('country');
            if (!country.value) {
                showError(country, 'countryError');
                isValid = false;
            } else {
                hideError(country, 'countryError');
            }
            
            return isValid;
        }

        // Afficher une erreur
        function showError(input, errorId) {
            input.classList.add('error');
            document.getElementById(errorId).classList.add('visible');
        }

        // Masquer une erreur
        function hideError(input, errorId) {
            input.classList.remove('error');
            document.getElementById(errorId).classList.remove('visible');
        }

        // Initialiser les options de paiement
        function initPaymentOptions() {
            const paymentOptions = document.querySelectorAll('.payment-option');
            const nextButton = document.getElementById('step4Next');
            
            paymentOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Désélectionner toutes les options
                    paymentOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Sélectionner l'option cliquée
                    option.classList.add('selected');
                    
                    // Stocker la méthode de paiement
                    orderData.paymentMethod = option.getAttribute('data-method');
                    
                    // Activer le bouton suivant
                    nextButton.disabled = false;
                    
                    // Masquer tous les conteneurs de méthode de paiement
                    document.querySelectorAll('.payment-method-container').forEach(container => {
                        container.classList.remove('active');
                    });
                    
                    // Afficher le conteneur approprié
                    const methodContainer = document.getElementById(orderData.paymentMethod + 'Container') || 
                                           document.getElementById(orderData.paymentMethod + 'Form');
                    if (methodContainer) {
                        methodContainer.classList.add('active');
                    }
                });
            });
        }

        // Initialiser PayPal
        function initPayPal() {
            if (window.paypal) {
                paypal.Buttons({
                    createOrder: function(data, actions) {
                        return actions.order.create({
                            purchase_units: [{
                                amount: {
                                    value: orderData.totalPrice.toFixed(2)
                                }
                            }]
                        });
                    },
                    onApprove: function(data, actions) {
                        return actions.order.capture().then(function(details) {
                            processPayment('paypal');
                        });
                    }
                }).render('#paypal-button-container');
            }
        }

        // Mettre à jour le prix total
        function updateTotalPrice() {
            // Prix du package
            let total = orderData.packagePrice;
            
            // Prix de la gravure
            let engravingPrice = 0;
            if (orderData.engraving.enabled) {
                engravingPrice = orderData.engraving.platesCount * ENGRAVING_PRICE_PER_PLATE;
                total += engravingPrice;
            }
            
            // Frais de livraison
            total += SHIPPING_PRICE;
            
            // Mettre à jour le prix total
            orderData.totalPrice = total;
            
            // Mettre à jour l'affichage
            document.getElementById('packagePrice').textContent = orderData.packagePrice.toFixed(2).replace('.', ',') + ' €';
            document.getElementById('engravingPrice').textContent = engravingPrice.toFixed(2).replace('.', ',') + ' €';
            document.getElementById('totalPrice').textContent = total.toFixed(2).replace('.', ',') + ' €';
            document.getElementById('selectedPackageName').textContent = orderData.packageName;
        }

        // Mettre à jour le récapitulatif de commande
        function updateOrderSummary() {
            // Informations du package
            document.getElementById('summaryPackageName').textContent = orderData.packageName;
            document.getElementById('summaryPackagePrice').textContent = orderData.packagePrice.toFixed(2).replace('.', ',') + ' €';
            
            // Informations de gravure
            if (orderData.engraving.enabled) {
                const engravingPrice = orderData.engraving.platesCount * ENGRAVING_PRICE_PER_PLATE;
                document.getElementById('summaryEngravingRow').style.display = 'flex';
                document.getElementById('summaryEngravingPriceRow').style.display = 'flex';
                document.getElementById('summaryEngraving').textContent = orderData.engraving.platesCount + ' plaque(s)';
                document.getElementById('summaryEngravingPrice').textContent = engravingPrice.toFixed(2).replace('.', ',') + ' €';
            } else {
                document.getElementById('summaryEngravingRow').style.display = 'none';
                document.getElementById('summaryEngravingPriceRow').style.display = 'none';
            }
            
            // Informations de livraison
            const addressText = `${orderData.shipping.firstName} ${orderData.shipping.lastName}<br>${orderData.shipping.address}<br>${orderData.shipping.postalCode} ${orderData.shipping.city}<br>${getCountryName(orderData.shipping.country)}`;
            document.getElementById('summaryAddress').innerHTML = addressText;
            
            // Prix total
            document.getElementById('summaryTotalPrice').textContent = orderData.totalPrice.toFixed(2).replace('.', ',') + ' €';
        }

        // Obtenir le nom du pays à partir du code
        function getCountryName(countryCode) {
            const countries = {
                'FR': 'France',
                'BE': 'Belgique',
                'CH': 'Suisse',
                'LU': 'Luxembourg',
                'CA': 'Canada',
                'MC': 'Monaco'
            };
            
            return countries[countryCode] || countryCode;
        }

        // Initialiser la navigation entre les étapes
        function initNavigation() {
            // Boutons suivant
            document.getElementById('step1Next').addEventListener('click', () => {
                goToStep(2);
                updatePlatesCountSelector();
            });
            
            document.getElementById('step2Next').addEventListener('click', () => {
                goToStep(3);
            });
            
            document.getElementById('step3Next').addEventListener('click', () => {
                if (validateShippingForm()) {
                    goToStep(4);
                    updateOrderSummary();
                }
            });
            
            document.getElementById('step4Next').addEventListener('click', () => {
                processPayment(orderData.paymentMethod);
            });
            
            // Boutons précédent
            document.getElementById('step2Prev').addEventListener('click', () => {
                goToStep(1);
            });
            
            document.getElementById('step3Prev').addEventListener('click', () => {
                goToStep(2);
            });
            
            document.getElementById('step4Prev').addEventListener('click', () => {
                goToStep(3);
            });
        }

        // Aller à une étape spécifique
        function goToStep(stepNumber) {
            // Masquer toutes les étapes
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Afficher l'étape demandée
            document.getElementById('step' + stepNumber).classList.add('active');
            
            // Mettre à jour les indicateurs d'étape
            document.querySelectorAll('.step').forEach(step => {
                const stepNum = parseInt(step.getAttribute('data-step'));
                
                step.classList.remove('active', 'completed');
                
                if (stepNum === stepNumber) {
                    step.classList.add('active');
                } else if (stepNum < stepNumber) {
                    step.classList.add('completed');
                }
            });
        }

        // Traiter le paiement
        function processPayment(method) {
            // Afficher l'overlay de traitement
            document.getElementById('processingOverlay').classList.add('active');
            
            // Simuler le traitement du paiement
            setTimeout(() => {
                // Rediriger vers la page de confirmation
                let redirectUrl = 'confirmation.html?';
                redirectUrl += 'order_id=SEED-' + Math.floor(100000 + Math.random() * 900000);
                redirectUrl += '&quantity=' + orderData.platesCount;
                redirectUrl += '&email=' + encodeURIComponent(orderData.shipping.email);
                redirectUrl += '&payment_method=' + method;
                redirectUrl += '&total=' + orderData.totalPrice.toFixed(2);
                redirectUrl += '&name=' + encodeURIComponent(orderData.shipping.firstName + ' ' + orderData.shipping.lastName);
                redirectUrl += '&address=' + encodeURIComponent(orderData.shipping.address + ', ' + orderData.shipping.postalCode + ' ' + orderData.shipping.city + ', ' + getCountryName(orderData.shipping.country));
                
                // Redirection spéciale pour Coinbase
                if (method === 'crypto') {
                    // Sauvegarder les informations de commande dans localStorage
                    localStorage.setItem('seedPendingOrder', JSON.stringify(orderData));
                    
                    // Rediriger vers Coinbase Commerce
                    window.location.href = 'https://commerce.coinbase.com/checkout/97d6c3e5-8c85-4905-b9f5-fb89a58a11cd';
                } else {
                    // Rediriger vers la page de confirmation
                    window.location.href = redirectUrl;
                }
            }, 2000);
        }
    </script>
</body>
</html>
